<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify - Rizal Ultimate Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1DB954">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <style>
        :root { --sp-green: #1DB954; }
        body { background-color: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        .app-container { display: grid; grid-template-columns: 280px 1fr; grid-template-rows: 1fr 90px; height: 100vh; display: none; }
        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; grid-template-rows: 1fr 140px; }
            .sidebar { display: none; }
            .mobile-nav { display: flex !important; }
            .player-bar { height: 140px; flex-direction: column; padding: 10px; bottom: 60px; }
        }
        .sidebar { background-color: #000; border-right: 1px solid #282828; padding: 24px; display: flex; flex-direction: column; }
        .main-view { background: linear-gradient(to bottom, #1e1e1e, #121212); overflow-y: auto; border-radius: 8px; margin: 8px 8px 0 0; }
        .mobile-nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: rgba(0,0,0,0.95); display: none; justify-content: space-around; align-items: center; border-top: 1px solid #282828; z-index: 1000; }
        .spotify-card { background: #181818; padding: 16px; border-radius: 8px; transition: 0.3s; cursor: pointer; }
        #suggestion-box { position: absolute; top: 100%; left: 0; width: 100%; background: #282828; border-radius: 8px; z-index: 100; display: none; border: 1px solid #333; }
        .player-bar { grid-column: span 2; background: #000; border-top: 1px solid #282828; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 500; }
        input[type="range"] { accent-color: var(--sp-green); cursor: pointer; }
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #yt-player { position: absolute; top: -1000px; left: -1000px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <i class="fab fa-spotify text-7xl text-[#1DB954] mb-8"></i>
        <h1 class="text-3xl font-black italic mb-10 tracking-tighter">RIZAL<span class="text-[#1DB954]">MUSIC</span></h1>
        <button onclick="loginGoogle()" class="bg-[#1DB954] text-black font-bold px-10 py-4 rounded-full flex items-center gap-3 active:scale-95 transition shadow-2xl">
            <i class="fab fa-google"></i> LOGIN WITH GOOGLE
        </button>
    </div>

    <div id="yt-player"><div id="player"></div></div>

    <div class="app-container" id="app">
        <aside class="sidebar">
            <div class="flex items-center gap-3 mb-10 text-2xl font-black italic"><i class="fab fa-spotify text-3xl text-[#1DB954]"></i> Spotify</div>
            <nav class="flex flex-col gap-6 font-bold text-zinc-400">
                <button onclick="goHome()" class="flex items-center gap-4 hover:text-white transition"><i class="fas fa-home text-2xl"></i> Home</button>
                <div class="relative w-full">
                    <i class="fas fa-search absolute left-3 top-3 text-zinc-500"></i>
                    <input type="text" id="searchInput" placeholder="Search..." autocomplete="off" class="w-full bg-zinc-800 py-2.5 px-10 rounded-md text-xs outline-none focus:ring-1 focus:ring-green-500">
                    <div id="suggestion-box"></div>
                </div>
                <hr class="border-zinc-800">
                <button onclick="showLibrary()" class="flex items-center gap-4 hover:text-white transition"><i class="fas fa-heart text-2xl text-red-500"></i> Liked Songs</button>
            </nav>
            <div class="mt-auto pt-6 border-t border-zinc-800 flex items-center gap-3">
                <img id="uImg" src="" class="w-10 h-10 rounded-full border border-zinc-700">
                <div class="overflow-hidden"><p id="uName" class="text-xs font-bold truncate">User</p><button onclick="logout()" class="text-[10px] text-zinc-500 hover:text-red-500">Sign Out</button></div>
            </div>
        </aside>

        <main class="main-view">
            <header class="p-6 sticky top-0 bg-[#121212]/95 backdrop-blur-xl z-50 flex justify-between items-center">
                <h2 id="viewTitle" class="text-xl md:text-3xl font-black">INDONESIA HITS</h2>
                <div class="md:hidden"><img id="uImgMobile" src="" class="w-8 h-8 rounded-full"></div>
            </header>
            <div class="p-4 md:p-8 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-8" id="musicGrid"></div>
        </main>

        <footer class="player-bar">
            <div class="flex items-center gap-3 w-full md:w-[30%]">
                <img id="pArt" src="" class="w-12 h-12 rounded hidden object-cover shadow-lg">
                <div class="overflow-hidden"><p id="pTitle" class="font-bold text-xs truncate">Pilih lagu...</p><p id="pArtist" class="text-[10px] text-zinc-500"></p></div>
                <button id="likeBtn" class="ml-auto text-zinc-600 hover:text-red-500"><i class="fas fa-heart text-lg"></i></button>
            </div>
            <div class="flex flex-col items-center w-full md:w-[40%] gap-1">
                <div class="flex items-center gap-6">
                    <button onclick="playPrev()" class="text-zinc-400 hover:text-white"><i class="fas fa-step-backward text-xl"></i></button>
                    <button id="playBtn" class="bg-white text-black w-8 h-8 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-play ml-1"></i></button>
                    <button onclick="playNext()" class="text-zinc-400 hover:text-white"><i class="fas fa-step-forward text-xl"></i></button>
                </div>
                <input type="range" id="pBar" value="0" class="w-full">
            </div>
        </footer>

        <nav class="mobile-nav">
            <button onclick="goHome()" class="flex flex-col items-center text-zinc-400"><i class="fas fa-home text-lg"></i><span class="text-[9px]">Home</span></button>
            <button onclick="showLibrary()" class="flex flex-col items-center text-zinc-400"><i class="fas fa-heart text-lg"></i><span class="text-[9px]">Library</span></button>
        </nav>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCOsJ3yJxnZah3JPx78Lu3PG0ujQd0rtlo",
            authDomain: "spotify-tets.firebaseapp.com",
            projectId: "spotify-tets",
            storageBucket: "spotify-tets.firebasestorage.app",
            messagingSenderId: "498499181915",
            appId: "1:498499181915:web:f07b3a4344ea657ba40e7e"
        };
        firebase.initializeApp(firebaseConfig);

        const API_KEY = 'AIzaSyBnWUujaOpbEd2BveLvUMWEglcbxs-TLFc';
        let player, playlist = [], library = [], curIdx = -1;

        function loginGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider).catch(e => alert("Error: " + e.message));
        }

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                document.getElementById('uImg').src = user.photoURL;
                document.getElementById('uImgMobile').src = user.photoURL;
                document.getElementById('uName').innerText = user.displayName;
                initYT();
            }
        });

        function initYT() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.body.appendChild(tag);
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '0', width: '0',
                playerVars: { 'autoplay': 0, 'controls': 0, 'origin': window.location.origin },
                events: { 'onReady': fetchHits, 'onStateChange': onState }
            });
        }

        async function fetchHits() {
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&videoCategoryId=10&maxResults=20&regionCode=ID&key=${API_KEY}`);
                const data = await res.json();
                playlist = data.items;
                render(playlist);
            } catch (e) { console.error("API error: ", e); }
        }

        function render(items) {
            const grid = document.getElementById('musicGrid');
            grid.innerHTML = '';
            items.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = 'spotify-card';
                card.innerHTML = `<img src="${item.snippet.thumbnails.medium.url}" class="w-full rounded mb-3"><h3 class="font-bold text-xs truncate">${item.snippet.title}</h3>`;
                card.onclick = () => playThis(i, items);
                grid.appendChild(card);
            });
        }

        function playThis(idx, list) {
            playlist = list; curIdx = idx;
            const s = playlist[idx];
            const id = (typeof s.id === 'string') ? s.id : s.id.videoId;
            player.loadVideoById(id);
            document.getElementById('pArt').src = s.snippet.thumbnails.medium.url;
            document.getElementById('pArt').classList.remove('hidden');
            document.getElementById('pTitle').innerText = s.snippet.title;
            document.getElementById('pArtist').innerText = s.snippet.channelTitle;
        }

        function onState(e) {
            document.getElementById('playBtn').innerHTML = (e.data == 1) ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play ml-1"></i>';
            if(e.data == 0) playNext();
        }

        function playNext() { if(curIdx < playlist.length-1) playThis(curIdx+1, playlist); }
        function playPrev() { if(curIdx > 0) playThis(curIdx-1, playlist); }
        document.getElementById('playBtn').onclick = () => player.getPlayerState()==1 ? player.pauseVideo() : player.playVideo();
    </script>
</body>
</html>
