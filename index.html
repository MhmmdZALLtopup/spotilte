<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spotify Pro - Rizal Ultimate Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <style>
        :root { --sp-green: #1DB954; }
        body { background-color: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; margin: 0; }
        
        .app-container { 
            display: grid; 
            grid-template-columns: 280px 1fr; 
            grid-template-rows: 1fr 90px; 
            height: 100vh; 
            display: none; 
        }

        @media (max-width: 768px) {
            .app-container { grid-template-columns: 1fr; grid-template-rows: 1fr 160px; }
            .sidebar { display: none !important; }
            .mobile-nav { display: flex !important; }
            .search-mobile-container { display: block !important; }
            .player-bar { position: fixed; bottom: 60px; width: 100%; height: 100px; flex-direction: column; padding: 10px; background: #000; border-top: 1px solid #282828; }
            .grid-music { grid-template-columns: repeat(2, 1fr) !important; gap: 12px !important; padding: 12px !important; }
        }

        .sidebar { background-color: #000; border-right: 1px solid #282828; padding: 24px; display: flex; flex-direction: column; height: 100%; }
        .main-view { background: linear-gradient(to bottom, #1e1e1e, #121212); overflow-y: auto; overflow-x: hidden; }
        .spotify-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; border-radius: 6px; background: #282828; }
        .mobile-nav { position: fixed; bottom: 0; width: 100%; height: 60px; background: rgba(0,0,0,0.95); display: none; justify-content: space-around; align-items: center; border-top: 1px solid #282828; z-index: 1000; }
        .player-bar { grid-column: span 2; background: #000; border-top: 1px solid #282828; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 500; }
        input[type="range"] { accent-color: var(--sp-green); cursor: pointer; }
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #yt-player { position: absolute; top: -1000px; left: -1000px; }
        .liked { color: #ef4444 !important; }
    </style>
</head>
<body>

    <div id="login-screen">
        <i class="fab fa-spotify text-7xl text-[#1DB954] mb-8 animate-pulse"></i>
        <h1 class="text-3xl font-black italic mb-10 text-white text-center">RIZAL<span class="text-[#1DB954]">MUSIC</span><br><span class="text-xs font-normal not-italic text-zinc-500">DKV EDITION</span></h1>
        <button onclick="loginGoogle()" class="bg-[#1DB954] text-black font-bold px-10 py-4 rounded-full flex items-center gap-3 active:scale-95 transition">
            <i class="fab fa-google"></i> LOGIN WITH GOOGLE
        </button>
    </div>

    <div id="yt-player"><div id="player"></div></div>

    <div class="app-container" id="app">
        <aside class="sidebar">
            <div class="flex items-center gap-3 mb-10 text-2xl font-black italic">
                <i class="fab fa-spotify text-3xl text-[#1DB954]"></i> <span>Spotify</span>
            </div>
            
            <nav class="flex flex-col gap-6 font-bold text-zinc-400">
                <button onclick="goHome()" class="flex items-center gap-4 hover:text-white transition"><i class="fas fa-home text-2xl"></i> Home</button>
                <div class="relative w-full">
                    <input type="text" id="searchDesktop" placeholder="Search Music..." class="w-full bg-zinc-800 py-2 px-4 rounded-md text-xs outline-none focus:ring-1 focus:ring-green-500">
                </div>
                <button onclick="showLibrary()" class="flex items-center gap-4 hover:text-white transition"><i class="fas fa-heart text-2xl text-red-500"></i> Liked Songs</button>
            </nav>

            <div id="userProfilePC" class="mt-auto pt-6 border-t border-zinc-800 flex items-center gap-3">
                <img id="uImgPC" src="" class="w-10 h-10 rounded-full border border-zinc-700">
                <div class="overflow-hidden flex-1">
                    <p id="uNamePC" class="text-xs font-bold truncate">Loading...</p>
                    <button onclick="logout()" class="text-[10px] text-zinc-500 hover:text-red-500 font-bold uppercase">Sign Out</button>
                </div>
            </div>
        </aside>

        <main class="main-view">
            <div class="search-mobile-container hidden p-4 sticky top-0 bg-black/80 z-50">
                <input type="text" id="searchMobile" placeholder="Cari lagu..." class="w-full bg-zinc-800 py-2 px-4 rounded-md text-sm outline-none">
            </div>

            <header class="p-6 flex justify-between items-center">
                <h2 id="viewTitle" class="text-xl md:text-3xl font-black uppercase tracking-tighter">Indonesia Hits</h2>
                <div class="md:hidden">
                    <img id="uImgMobile" src="" class="w-9 h-9 rounded-full border border-zinc-700">
                </div>
            </header>
            
            <div class="grid-music p-4 md:p-8 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-8" id="musicGrid"></div>
        </main>

        <footer class="player-bar">
            <div class="flex items-center gap-3 w-full md:w-[30%]">
                <img id="pArt" src="" class="w-12 h-12 rounded hidden object-cover">
                <div class="overflow-hidden flex-1">
                    <p id="pTitle" class="font-bold text-[11px] md:text-sm truncate">Ready to play</p>
                    <p id="pArtist" class="text-[9px] text-zinc-500 truncate"></p>
                </div>
                <button id="likeBtn" onclick="toggleLike()" class="text-zinc-600 px-2 transition"><i class="fas fa-heart text-xl"></i></button>
            </div>

            <div class="flex flex-col items-center w-full md:w-[40%] gap-1">
                <div class="flex items-center gap-8">
                    <button onclick="playPrev()" class="text-zinc-400"><i class="fas fa-step-backward text-xl"></i></button>
                    <button id="playBtn" class="bg-white text-black w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-play ml-1"></i></button>
                    <button onclick="playNext()" class="text-zinc-400"><i class="fas fa-step-forward text-xl"></i></button>
                </div>
                <div class="flex items-center gap-3 w-full max-w-lg px-2">
                    <span id="curT" class="text-[9px] text-zinc-500">0:00</span>
                    <input type="range" id="pBar" value="0" class="flex-1 h-1">
                    <span id="durT" class="text-[9px] text-zinc-500">0:00</span>
                </div>
            </div>
        </footer>

        <nav class="mobile-nav">
            <button onclick="goHome()" class="flex flex-col items-center text-zinc-400"><i class="fas fa-home text-xl"></i><span class="text-[10px] mt-1">Home</span></button>
            <button onclick="showLibrary()" class="flex flex-col items-center text-zinc-400"><i class="fas fa-heart text-xl"></i><span class="text-[10px] mt-1">Library</span></button>
            <button onclick="logout()" class="flex flex-col items-center text-zinc-400"><i class="fas fa-sign-out-alt text-xl"></i><span class="text-[10px] mt-1">Exit</span></button>
        </nav>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCOsJ3yJxnZah3JPx78Lu3PG0ujQd0rtlo",
            authDomain: "spotify-tets.firebaseapp.com",
            projectId: "spotify-tets",
            storageBucket: "spotify-tets.firebasestorage.app",
            messagingSenderId: "498499181915",
            appId: "1:498499181915:web:f07b3a4344ea657ba40e7e"
        };
        firebase.initializeApp(firebaseConfig);

        const API_KEY = 'AIzaSyBnWUujaOpbEd2BveLvUMWEglcbxs-TLFc';
        let player, playlist = [], library = [], curIdx = -1;

        function loginGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider).catch(e => alert(e.message));
        }

        function logout() { firebase.auth().signOut(); location.reload(); }

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                document.getElementById('uImgPC').src = user.photoURL;
                document.getElementById('uNamePC').innerText = user.displayName;
                document.getElementById('uImgMobile').src = user.photoURL;
                
                // Ambil data Like dari Storage
                const saved = localStorage.getItem('rizal_liked');
                if(saved) library = JSON.parse(saved);
                
                initYT();
            }
        });

        function initYT() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.body.appendChild(tag);
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '0', width: '0',
                playerVars: { 'autoplay': 0, 'controls': 0, 'origin': 'https://spotilte.vercel.app' },
                events: { 'onReady': fetchHits, 'onStateChange': onState }
            });
        }

        async function fetchHits() {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&videoCategoryId=10&maxResults=20&regionCode=ID&key=${API_KEY}`);
            const data = await res.json();
            playlist = data.items;
            render(playlist);
        }

        function render(items) {
            const grid = document.getElementById('musicGrid');
            grid.innerHTML = '';
            items.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = 'spotify-card group cursor-pointer';
                card.innerHTML = `<img src="${item.snippet.thumbnails.medium.url}"><h3 class="font-bold text-[10px] md:text-xs truncate mt-2 text-zinc-300">${item.snippet.title}</h3>`;
                card.onclick = () => playThis(i, items);
                grid.appendChild(card);
            });
        }

        function playThis(idx, list) {
            playlist = list; curIdx = idx;
            const s = playlist[idx];
            const id = (typeof s.id === 'string') ? s.id : s.id.videoId;
            player.loadVideoById(id);
            document.getElementById('pArt').src = s.snippet.thumbnails.medium.url;
            document.getElementById('pArt').classList.remove('hidden');
            document.getElementById('pTitle').innerText = s.snippet.title;
            document.getElementById('pArtist').innerText = s.snippet.channelTitle;
            updateLikeUI();
        }

        // FUNGSI LIKE (FIXED)
        function toggleLike() {
            if(curIdx === -1) return;
            const s = playlist[curIdx];
            const sId = (typeof s.id === 'string') ? s.id : s.id.videoId;
            const exists = library.findIndex(x => (typeof x.id === 'string' ? x.id : x.id.videoId) === sId);

            if(exists > -1) {
                library.splice(exists, 1);
            } else {
                library.push(s);
            }
            localStorage.setItem('rizal_liked', JSON.stringify(library));
            updateLikeUI();
        }

        function updateLikeUI() {
            if(curIdx === -1) return;
            const s = playlist[curIdx];
            const sId = (typeof s.id === 'string') ? s.id : s.id.videoId;
            const isLiked = library.some(x => (typeof x.id === 'string' ? x.id : x.id.videoId) === sId);
            document.getElementById('likeBtn').className = isLiked ? 'liked px-2' : 'text-zinc-600 px-2';
        }

        function goHome() { document.getElementById('viewTitle').innerText="Indonesia Hits"; fetchHits(); }
        function showLibrary() { 
            document.getElementById('viewTitle').innerText="Liked Songs"; 
            render(library); 
        }

        function onState(e) {
            document.getElementById('playBtn').innerHTML = (e.data == 1) ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play ml-1"></i>';
            if(e.data == 0) playNext();
            if(e.data == 1) syncProg();
        }

        function syncProg() {
            if(player.getPlayerState() == 1) {
                const c = player.getCurrentTime(), d = player.getDuration();
                document.getElementById('pBar').value = (c/d)*100 || 0;
                document.getElementById('curT').innerText = fmt(c);
                document.getElementById('durT').innerText = fmt(d);
                setTimeout(syncProg, 1000);
            }
        }
        function fmt(s) { const m=Math.floor(s/60), sec=Math.floor(s%60); return `${m}:${sec<10?'0':''}${sec}`; }
        function playNext() { if(curIdx < playlist.length-1) playThis(curIdx+1, playlist); }
        function playPrev() { if(curIdx > 0) playThis(curIdx-1, playlist); }
        document.getElementById('playBtn').onclick = () => player.getPlayerState()==1 ? player.pauseVideo() : player.playVideo();
        
        // Search PC
        document.getElementById('searchDesktop').onkeypress = async (e) => {
            if(e.key === 'Enter') {
                const q = e.target.value;
                const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=20&q=${q}&type=video&key=${API_KEY}`);
                const data = await res.json();
                playlist = data.items;
                document.getElementById('viewTitle').innerText = "Hasil: " + q;
                render(playlist);
            }
        }
    </script>
</body>
</html>
