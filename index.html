<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Pro - Rizal Ultimate Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1DB954">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <style>
        :root { --sp-green: #1DB954; }
        body { background-color: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* Responsive Layout */
        .app-container { 
            display: grid; 
            grid-template-columns: 280px 1fr; 
            grid-template-rows: 1fr 90px; 
            height: 100vh; 
            display: none; 
        }

        /* Penyesuaian Mobile (Android/HP) */
        @media (max-width: 768px) {
            .app-container { 
                grid-template-columns: 1fr; 
                grid-template-rows: 1fr 140px; 
            }
            .sidebar { display: none; } /* Sembunyikan sidebar di HP */
            .mobile-nav { display: flex !important; } /* Tampilkan navigasi bawah */
            .player-bar { 
                height: 140px; 
                flex-direction: column; 
                padding: 10px;
                bottom: 60px; /* Di atas mobile nav */
            }
            .player-info { width: 100% !important; justify-content: center; }
            .player-controls { width: 100% !important; }
        }

        .sidebar { background-color: #000; border-right: 1px solid #282828; padding: 24px; display: flex; flex-direction: column; }
        .main-view { background: linear-gradient(to bottom, #1e1e1e, #121212); overflow-y: auto; border-radius: 8px; margin: 8px 8px 0 0; }
        
        /* Mobile Bottom Nav */
        .mobile-nav { 
            position: fixed; bottom: 0; width: 100%; height: 60px; 
            background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
            display: none; justify-content: space-around; align-items: center;
            border-top: 1px solid #282828; z-index: 1000;
        }

        .spotify-card { background: #181818; padding: 12px; border-radius: 8px; transition: 0.3s; cursor: pointer; }
        .spotify-card:hover { background: #282828; }
        
        #suggestion-box { position: absolute; top: 100%; left: 0; width: 100%; background: #282828; border-radius: 8px; z-index: 100; display: none; border: 1px solid #333; }
        .suggestion-item { padding: 12px; cursor: pointer; font-size: 13px; }

        .player-bar { grid-column: span 2; background: #000; border-top: 1px solid #282828; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 500; }
        input[type="range"] { accent-color: var(--sp-green); cursor: pointer; }
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #yt-player { position: absolute; top: -1000px; left: -1000px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <i class="fab fa-spotify text-7xl text-[#1DB954] mb-8"></i>
        <h1 class="text-3xl font-black italic mb-10 tracking-tighter text-white">RIZAL<span class="text-[#1DB954]">MUSIC</span></h1>
        <button onclick="loginGoogle()" class="bg-[#1DB954] text-black font-bold px-10 py-4 rounded-full flex items-center gap-3 active:scale-95 transition shadow-2xl">
            <i class="fab fa-google"></i> LOGIN WITH GOOGLE
        </button>
    </div>

    <div id="yt-player"><div id="player"></div></div>

    <div class="app-container" id="app">
        <aside class="sidebar">
            <div class="flex items-center gap-3 mb-10 text-2xl font-black italic"><i class="fab fa-spotify text-3xl text-[#1DB954]"></i> Spotify</div>
            <nav class="flex flex-col gap-6 font-bold text-zinc-400">
                <button onclick="goHome()" class="flex items-center gap-4 hover:text-white transition"><i class="fas fa-home text-2xl"></i> Home</button>
                <div class="relative w-full">
                    <i class="fas fa-search absolute left-3 top-3 text-zinc-500"></i>
                    <input type="text" id="searchInput" placeholder="Search..." autocomplete="off" class="w-full bg-zinc-800 py-2.5 px-10 rounded-md text-xs outline-none focus:ring-1 focus:ring-green-500">
                    <div id="suggestion-box"></div>
                </div>
                <hr class="border-zinc-800">
                <button onclick="showLibrary()" class="flex items-center gap-4 hover:text-white transition"><i class="fas fa-heart text-2xl text-red-500"></i> Liked Songs</button>
            </nav>
            <div class="mt-auto pt-6 border-t border-zinc-800 flex items-center gap-3">
                <img id="uImg" src="" class="w-10 h-10 rounded-full border border-zinc-700">
                <div class="overflow-hidden">
                    <p id="uName" class="text-xs font-bold truncate">User</p>
                    <button onclick="logout()" class="text-[10px] text-zinc-500 hover:text-red-500">Sign Out</button>
                </div>
            </div>
        </aside>

        <main class="main-view">
            <header class="p-6 sticky top-0 bg-[#121212]/95 backdrop-blur-xl z-50 flex justify-between items-center">
                <h2 id="viewTitle" class="text-xl md:text-3xl font-black">INDONESIA HITS</h2>
                <div class="md:hidden">
                    <img id="uImgMobile" src="" class="w-8 h-8 rounded-full">
                </div>
            </header>
            <div class="p-4 md:p-8 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-8" id="musicGrid"></div>
        </main>

        <footer class="player-bar">
            <div class="player-info flex items-center gap-3 w-full md:w-[30%]">
                <img id="pArt" src="" class="w-12 h-12 md:w-14 md:h-14 rounded hidden object-cover shadow-lg">
                <div class="overflow-hidden max-w-[150px] md:max-w-full">
                    <p id="pTitle" class="font-bold text-xs md:text-sm truncate">Pilih lagu...</p>
                    <p id="pArtist" class="text-[10px] text-zinc-500 truncate"></p>
                </div>
                <button id="likeBtn" class="ml-auto md:ml-4 text-zinc-600 hover:text-red-500"><i class="fas fa-heart text-lg"></i></button>
            </div>

            <div class="player-controls flex flex-col items-center w-full md:w-[40%] gap-1">
                <div class="flex items-center gap-6">
                    <button onclick="playPrev()" class="text-zinc-400 hover:text-white"><i class="fas fa-step-backward text-xl"></i></button>
                    <button id="playBtn" class="bg-white text-black w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-play ml-1"></i></button>
                    <button onclick="playNext()" class="text-zinc-400 hover:text-white"><i class="fas fa-step-forward text-xl"></i></button>
                </div>
                <div class="flex items-center gap-3 w-full max-w-lg">
                    <span id="curT" class="text-[9px] text-zinc-500 font-mono">0:00</span>
                    <input type="range" id="pBar" value="0" class="flex-1 h-1">
                    <span id="durT" class="text-[9px] text-zinc-500 font-mono">0:00</span>
                </div>
            </div>

            <div class="w-[30%] hidden md:flex justify-end items-center gap-3">
                <i class="fas fa-volume-up text-zinc-500 text-xs"></i>
                <input type="range" id="vBar" value="100" class="w-24">
            </div>
        </footer>

        <nav class="mobile-nav">
            <button onclick="goHome()" class="flex flex-col items-center text-zinc-400 hover:text-white"><i class="fas fa-home text-lg"></i><span class="text-[9px] mt-1">Home</span></button>
            <button onclick="focusSearch()" class="flex flex-col items-center text-zinc-400 hover:text-white"><i class="fas fa-search text-lg"></i><span class="text-[9px] mt-1">Search</span></button>
            <button onclick="showLibrary()" class="flex flex-col items-center text-zinc-400 hover:text-white"><i class="fas fa-heart text-lg"></i><span class="text-[9px] mt-1">Library</span></button>
        </nav>
    </div>

    <script>
        // FIREBASE RIZAL
        const firebaseConfig = {
            apiKey: "AIzaSyCOsJ3yJxnZah3JPx78Lu3PG0uj (KUNCI FIREBASE KAMU)",
            authDomain: "spotify-tets.firebaseapp.com",
            projectId: "spotify-tets",
            storageBucket: "spotify-tets.firebasestorage.app",
            messagingSenderId: "498499181915",
            appId: "1:498499181915:web:f07b3a4344ea657ba40e7e"
        };
        firebase.initializeApp(firebaseConfig);

        const API_KEY = 'AIzaSyBnWUujaOpbEd2BveLvUMWEglcbxs-TLFc';
        let player, playlist = [], library = [], curIdx = -1;

        function loginGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider).catch(e => alert("Pastikan domain onecompiler.com sudah di-authorized di Firebase!"));
        }

        function logout() { firebase.auth().signOut(); location.reload(); }

        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                document.getElementById('uImg').src = user.photoURL;
                document.getElementById('uImgMobile').src = user.photoURL;
                document.getElementById('uName').innerText = user.displayName;
                if(localStorage.getItem('rizal_liked')) library = JSON.parse(localStorage.getItem('rizal_liked'));
                initYT();
            }
        });

        function initYT() {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.body.appendChild(tag);
        }

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '0', width: '0',
                playerVars: { 'autoplay': 0, 'controls': 0, 'origin': window.location.origin },
                events: { 'onReady': fetchHits, 'onStateChange': onState }
            });
        }

        async function fetchHits() {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&videoCategoryId=10&maxResults=20&regionCode=ID&key=${API_KEY}`);
            const data = await res.json();
            playlist = data.items;
            render(playlist);
        }

        function render(items) {
            const grid = document.getElementById('musicGrid');
            grid.innerHTML = '';
            items.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = 'spotify-card group';
                card.innerHTML = `
                    <div class="relative mb-3"><img src="${item.snippet.thumbnails.medium.url}" class="w-full aspect-square object-cover rounded shadow-lg"></div>
                    <h3 class="font-bold text-[10px] md:text-xs truncate">${item.snippet.title}</h3>
                `;
                card.onclick = () => playThis(i, items);
                grid.appendChild(card);
            });
        }

        function playThis(idx, listSource) {
            playlist = listSource; curIdx = idx;
            const s = playlist[idx];
            const vidId = (typeof s.id === 'string') ? s.id : s.id.videoId;
            player.loadVideoById(vidId);
            
            // Background Play Metadata
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: s.snippet.title, artist: s.snippet.channelTitle,
                    artwork: [{ src: s.snippet.thumbnails.high.url, sizes: '512x512', type: 'image/png' }]
                });
            }

            document.getElementById('pArt').src = s.snippet.thumbnails.medium.url;
            document.getElementById('pArt').classList.remove('hidden');
            document.getElementById('pTitle').innerText = s.snippet.title;
            document.getElementById('pArtist').innerText = s.snippet.channelTitle;
        }

        function onState(e) {
            document.getElementById('playBtn').innerHTML = (e.data == 1) ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play ml-1"></i>';
            if(e.data == 0) playNext();
            if(e.data == 1) syncProg();
        }

        function syncProg() {
            if(player.getPlayerState() == 1) {
                const c = player.getCurrentTime(), d = player.getDuration();
                document.getElementById('pBar').value = (c/d)*100 || 0;
                document.getElementById('curT').innerText = fmt(c);
                document.getElementById('durT').innerText = fmt(d);
                setTimeout(syncProg, 1000);
            }
        }
        function fmt(s) { const m=Math.floor(s/60), sec=Math.floor(s%60); return `${m}:${sec<10?'0':''}${sec}`; }

        // NAVIGATION MOBILE & SEARCH
        function focusSearch() { document.getElementById('searchInput').focus(); }
        function goHome() { document.getElementById('viewTitle').innerText="INDONESIA HITS"; fetchHits(); }
        function showLibrary() { document.getElementById('viewTitle').innerText="LIKED SONGS"; render(library); }
        function playNext() { if(curIdx < playlist.length-1) playThis(curIdx+1, playlist); }
        function playPrev() { if(curIdx > 0) playThis(curIdx-1, playlist); }
        document.getElementById('playBtn').onclick = () => player.getPlayerState()==1 ? player.pauseVideo() : player.playVideo();
        document.getElementById('vBar').oninput = (e) => player.setVolume(e.target.value);
    </script>
</body>
</html>
